name: Nexus Fusion - Merge 12 Source Repositories

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: 'Type "FUSE" to confirm the fusion operation'
        required: true
        default: ''

jobs:
  nexus-fusion:
    runs-on: ubuntu-latest
    if: github.event.inputs.confirm == 'FUSE'
    
    steps:
      - name: Checkout Nexus Guardian Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configure Git
        run: |
          git config --global user.name "Nexus Fusion Bot"
          git config --global user.email "nexus-fusion@github.actions"
          git config --global pull.rebase false
      
      - name: Create modules directory
        run: |
          mkdir -p modules
          echo "# Nexus Modules" > modules/README.md
          echo "This directory contains the fused source repositories as git subtrees." >> modules/README.md
          echo "" >> modules/README.md
          echo "## Source Repositories:" >> modules/README.md
          git add modules/README.md
          git commit -m "ðŸ“¦ Create modules directory for Nexus fusion"
      
      - name: Fuse trinity-xai-exoplanets
        run: |
          git subtree add --prefix=modules/trinity-xai-exoplanets \
            https://github.com/deegpnini/trinity-xai-exoplanets.git main || true
        continue-on-error: false
      
      - name: Fuse Arcturus-8-9
        run: |
          git subtree add --prefix=modules/Arcturus-8-9 \
            https://github.com/deegpnini/Arcturus-8-9.git main || true
        continue-on-error: false
      
      - name: Fuse trinity-quantum-memory-system
        run: |
          git subtree add --prefix=modules/trinity-quantum-memory-system \
            https://github.com/deegpnini/trinity-quantum-memory-system.git main || true
        continue-on-error: false
      
      - name: Fuse frete-facil-plus
        run: |
          git subtree add --prefix=modules/frete-facil-plus \
            https://github.com/deegpnini/frete-facil-plus.git main || true
        continue-on-error: false
      
      - name: Fuse trinity-framework
        run: |
          git subtree add --prefix=modules/trinity-framework \
            https://github.com/deegpnini/trinity-framework..git main || true
        continue-on-error: false
      
      - name: Fuse try-g-nexus
        run: |
          git subtree add --prefix=modules/try-g-nexus \
            https://github.com/deegpnini/try-g-nexus.git main || true
        continue-on-error: false
      
      - name: Fuse Trinity-Falcon-Lung
        run: |
          git subtree add --prefix=modules/Trinity-Falcon-Lung \
            https://github.com/deegpnini/Trinity-Falcon-Lung.git main || true
        continue-on-error: false
      
      - name: Fuse D7D
        run: |
          git subtree add --prefix=modules/D7D \
            https://github.com/deegpnini/D7D.git main || true
        continue-on-error: false
      
      - name: Fuse trinity-resilience-protocol
        run: |
          git subtree add --prefix=modules/trinity-resilience-protocol \
            https://github.com/deegpnini/-trinity-resilience-protocol.git main || true
        continue-on-error: false
      
      - name: Fuse D7D-CODEX
        run: |
          git subtree add --prefix=modules/D7D-CODEX \
            https://github.com/deegpnini/D7D-CODEX.git main || true
        continue-on-error: false
      
      - name: Fuse PROJETO_INTERESTELAR_HEBRON
        run: |
          git subtree add --prefix=modules/PROJETO_INTERESTELAR_HEBRON \
            https://github.com/deegpnini/PROJETO_INTERESTELAR_HEBRON.git main || true
        continue-on-error: false
      
      - name: Fuse TorreHebron
        run: |
          git subtree add --prefix=modules/TorreHebron \
            https://github.com/deegpnini/TorreHebron.git main || true
        continue-on-error: false
      
      - name: Update modules README with fusion details
        run: |
          cat >> modules/README.md << 'EOF'
          
          1. trinity-xai-exoplanets - Collaborative AI models for exoplanet research
          2. Arcturus-8-9 - Scientific reliability assessment system
          3. trinity-quantum-memory-system - Quantum memory persistence system
          4. frete-facil-plus - Freight management system
          5. trinity-framework - Consciousness correlation engine
          6. try-g-nexus - Web application interface
          7. Trinity-Falcon-Lung - Falcon 9 optimization
          8. D7D - Core D7D system
          9. trinity-resilience-protocol - Adaptive resilience protocol
          10. D7D-CODEX - Sistema Orquestral D7D
          11. PROJETO_INTERESTELAR_HEBRON - Integrated system developed in Termux
          12. TorreHebron - Brazilian computational astronomy framework
          
          ## Fusion Information
          - Fusion Date: ${{ github.event.repository.updated_at }}
          - Fusion Method: git subtree with full history preservation
          - Fusion Operator: ${{ github.actor }}
          EOF
          
          git add modules/README.md
          git commit -m "ðŸ“ Update modules README with fusion details"
      
      - name: Push changes
        run: |
          git push origin ${{ github.ref }}
      
      - name: Create Fusion Summary
        run: |
          echo "## ðŸŒ€ Nexus Fusion Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Successfully fused 12 source repositories into the Nexus Guardian:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… All repositories have been added as git subtrees under \`modules/\`" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Complete git history preserved for all repositories" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Changes pushed to branch: \`${{ github.ref }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Fused Repositories:" >> $GITHUB_STEP_SUMMARY
          echo "1. trinity-xai-exoplanets" >> $GITHUB_STEP_SUMMARY
          echo "2. Arcturus-8-9" >> $GITHUB_STEP_SUMMARY
          echo "3. trinity-quantum-memory-system" >> $GITHUB_STEP_SUMMARY
          echo "4. frete-facil-plus" >> $GITHUB_STEP_SUMMARY
          echo "5. trinity-framework" >> $GITHUB_STEP_SUMMARY
          echo "6. try-g-nexus" >> $GITHUB_STEP_SUMMARY
          echo "7. Trinity-Falcon-Lung" >> $GITHUB_STEP_SUMMARY
          echo "8. D7D" >> $GITHUB_STEP_SUMMARY
          echo "9. trinity-resilience-protocol" >> $GITHUB_STEP_SUMMARY
          echo "10. D7D-CODEX" >> $GITHUB_STEP_SUMMARY
          echo "11. PROJETO_INTERESTELAR_HEBRON" >> $GITHUB_STEP_SUMMARY
          echo "12. TorreHebron" >> $GITHUB_STEP_SUMMARY
